name: Supabase Keep-Alive

on:
  schedule:
    # Ø§Ù„ØªØ´ØºÙŠÙ„ ÙƒÙ„ 6 Ø³Ø§Ø¹Ø§Øª Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ù…Ø³ØªÙ…Ø± ÙˆØ¹Ø¯Ù… ØªÙˆÙ‚Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
    - cron: "0 */6 * * *"
  # ÙŠØ³Ù…Ø­ Ù„Ùƒ Ø¨ØªØ´ØºÙŠÙ„Ù‡ ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù„Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„ÙÙˆØ±ÙŠØ©
  workflow_dispatch: {}

jobs:
  wake-up-and-verify:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Supabase and Verify Status
        env:
          # ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø§Ø¨Ø· Ù‡Ù†Ø§ Ø¨Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
          SUPABASE_URL: 'https://wjaqthkgwmqnuesrsvxr.supabase.co/rest/v1/users?select=id&limit=1'
          SUPABASE_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
        run: |
          MAX_RETRIES=5
          RETRY_DELAY=15
          
          echo "ğŸ“¡ Connecting to Supabase Project (wjaqthkgwmqnuesrsvxr)..."
          
          for ((i=1; i<=MAX_RETRIES; i++)); do
            # Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙˆØ¯ Ø§Ù„Ø­Ø§Ù„Ø© ÙÙ‚Ø·
            HTTP_STATUS=$(curl -o /dev/null -s -w "%{http_code}" -X GET "$SUPABASE_URL" \
              -H "apikey: $SUPABASE_KEY" \
              -H "Authorization: Bearer $SUPABASE_KEY")
            
            if [ "$HTTP_STATUS" -eq 200 ]; then
              echo "âœ… Success! Database is Active and Responding (Status: 200)."
              exit 0
            else
              echo "âš ï¸ Attempt $i/$MAX_RETRIES failed (Status: $HTTP_STATUS). Database might be sleeping..."
              
              if [ $i -lt $MAX_RETRIES ]; then
                echo "â³ Waiting ${RETRY_DELAY} seconds for wake-up..."
                sleep $RETRY_DELAY
              fi
            fi
          done
          
          echo "âŒ Critical: Failed to wake up database after $MAX_RETRIES attempts."
          exit 1
